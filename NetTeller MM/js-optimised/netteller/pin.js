define(["lib/jquery","lib/knockout","netteller/session","netteller/security","netteller/localstorage","config/environment","lib/toolkit","lib/underscore"],function(e,t,n,r,i,s,o,u){var a=parseInt(s.strings["lang.pinlength"],10),f=function(e){if(!o.hasValue(e)||e.length<2)return!1;var t=parseInt(e.charAt(0),10)-parseInt(e.charAt(1),10);return t!==-1?!1:e.length==2?!0:f(e.substring(1))},l=function(e){return!o.hasValue(e)||e.length<1?!1:u.all(e.split(""),function(t){return t===e[0]})},c=function(e,t,i){if(e===!1){r.isTokenVerified(!1),h.doingPreLoginWorkflow.resolve();return}n.globalNotifications=i.Notifications,r.isTokenVerified(i.IsTokenVerified),h.doingPreLoginWorkflow.resolve()},h={pinLength:a,settingsPageStatus:t.observable(""),pinMode:t.observable(),pinModeEnum:{Register:0,Change:1,RegisterFromSettings:2,Login:3},doingPreLoginWorkflow:e.Deferred(),isValidPin:function(e){e=e.toString();var t=e.split("").reverse().join(""),n=/^\d+$/;return e.length===a&&n.test(e)&&!l(e)&&!f(e)&&!f(t)},doPreLoginWorkflow:function(){h.doingPreLoginWorkflow=e.Deferred(),n.preLoginWorkflow(i.hasPin()?i.getPinLoginToken():null,i.getTokenId(),c),i.hasPin()||r.isTokenVerified(!1)}};return h})