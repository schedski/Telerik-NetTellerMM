define(["lib/jquery","netteller/session","lib/knockout","lib/toolkit","ui/loader","netteller/login","netteller/security","netteller/localstorage","config/environment","ui/startup","ui/validation"],function(e,t,n,r,i,s,o,u,a){var f,l,c=new i.TimedLoader(a.strings["loader.passwordchange"]),h=function(e){return e.length!==0&&e.length>=6&&e.length<=20&&e.match(/[a-z]/)&&e.match(/[0-9]/)&&e.match(/[A-Z]/)},p={password:n.observable("").extend({required:{params:!0,message:a.strings["msg.required"]}}),passwordConfirm:n.observable("").extend({required:{params:!0,message:a.strings["msg.required"]}}),pageMessage:n.observable(""),passwordChangeClick:function(){if(p.errors().length>0){p.errors.showAllMessages();return}if(p.password()!==p.passwordConfirm()){r.displayPageMessage(p,"pageMessage",a.strings["msg.passwordmatch"],e("#passwordChangeMessagePopup"));return}if(!h(p.password())||!h(p.passwordConfirm())){r.displayPageMessage(p,"pageMessage",a.strings["msg.passwordinvalid"],e("#passwordChangeMessagePopup"));return}c.reset(),c.show(),s.doChangePasswordWorkFlowStep(p.password(),p.passwordConfirm(),f)},reset:function(){p.password(""),p.passwordConfirm(""),p.pageMessage("")}};t.viewModels.push(p),p.errors=n.validation.group(p),f=function(t,n,i){var o=function(){if(t===!0){if(i.State===s.responseCommand.AcceptLogin){s.loginLoader.reset(),s.loginLoader.show(),s.doAcceptLoginWorkFlowStep(l);return}if(i.State===s.responseCommand.MustAcceptTermsAndConditions){s.setTermsAndConditions(i),e.mobile.changePage("#loginTerms",i);return}}p.reset(),r.displayPageMessage(p,"pageMessage",n,e("#passwordChangeMessagePopup"))};c.loadFinished(o)},l=function(t,n,i){var u=function(){if(t)if(i.State===s.responseCommand.LoginProcessAccepted)o.isLoggedIn=!0,s.doLoginProcessAcceptedStep(i.HasPinCodeRegistered);else{if(i.State===s.responseCommand.MustAcceptTermsAndConditions){s.setTermsAndConditions(i),e.mobile.changePage("#loginTerms",i);return}p.reset(),r.displayPageMessage(p,"pageMessage",n,e("#passwordChangeMessagePopup"))}};c.loadFinished(u)},n.applyBindings(p,e("#passwordChange").get(0)),e("#passwordChange").on("pagehide",function(){p.reset()})})