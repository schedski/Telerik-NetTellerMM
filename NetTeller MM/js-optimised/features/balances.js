define(["lib/jquery","netteller/accounts","netteller/session","netteller/transactions","lib/knockout","lib/accounting","ui/loader","ui/accountHelper","config/environment","ui/startup"],function(e,t,n,r,i,s,o,u,a){var f=new o.TimedLoader(a.strings["loader.accounts"]),l=!1,c=function(t){var n=this;this.AccountName=i.observable(t.DisplayAccountName),this.BSB=i.observable(t.BSBWithDash),this.AccountNumber=i.observable(t.DisplayAccountNumber),this.CurrentBalance=i.observable(Number(t.CurrentBalance)),this.DisplayCurrentBalance=i.computed(function(){return s.formatMoney(n.CurrentBalance())}),this.AvailableBalance=i.observable(Number(t.AvailableBalance)),this.DisplayAvailableBalance=i.computed(function(){return s.formatMoney(n.AvailableBalance())}),this.AccountType=i.observable(t.AccountType),this.IsCurrentBalanceNegative=i.computed(function(){return n.CurrentBalance()<0}),this.AccountTypeImage=i.computed({read:function(){return u.getAccountTypeImageSrc(n.AccountType())},deferEvaluation:!0}),this.ViewTransactions=function(){r.selectedAccountNumber=t.AccountNumber,e.mobile.changePage("#transactions",{transition:"none"})}},h={welcomeMessageLine1:i.observable(""),welcomeMessageLine2:i.observable(""),welcomeMessageLine3:i.observable(""),accounts:i.observableArray([]),reset:function(){h.accounts([]),h.welcomeMessageLine1(""),h.welcomeMessageLine2(""),h.welcomeMessageLine3("")},hasAccounts:i.observable(!0),reasonForNoAccounts:i.observable("")};n.viewModels.push(h);var p=function(t){var n=function(){h.accounts.removeAll(),e.each(t.Accounts,function(e,t){h.accounts.push(new c(t))}),l&&setTimeout(function(){e("#welcomePopup").popup("open")},300)};h.hasAccounts(t.Accounts!==undefined&&t.Accounts.length>0),h.hasAccounts()||(h.reasonForNoAccounts(t.Success?a.strings["msg.noaccounts"]:a.strings["msg.generalfail"]),l=!1),t.Accounts===undefined||t.Accounts.length===0?f.loadFinished():f.loadFinished(n)};e("#accounts").on("pageinit",function(){i.applyBindings(h,e("#accounts").get(0)),h.hasAccounts(!0)}),e("#accounts").on("pagebeforeshow",function(e,n){f.reset(),f.startBackgroundLoad(),t.getAccounts(p)}),e("#accounts").on("pageshow",function(){f.show()})})