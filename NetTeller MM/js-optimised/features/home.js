define(["lib/jquery","config/client","netteller/session","lib/knockout","netteller/pin","netteller/security","netteller/localstorage","netteller/versioning","config/environment","ui/startup"],function(e,t,n,r,i,s,o,u,a){var f={pageMessage:r.observable(""),popupMessage:r.observable(""),futureOutageMessage:r.observable(""),login:function(){if(f.popupMessage().length>0){e("#homeMessagePopup").popup("open");return}if(o.hasHomePageErrorMessage()){o.removeHomePageErrorMessage(),l();return}i.doingPreLoginWorkflow.done(function(){l()})}},l=function(){f.popupMessage(""),f.futureOutageMessage(""),s.isTokenVerified()?(i.pinMode(i.pinModeEnum.Login),e.mobile.changePage("#pinKeypad")):e.mobile.changePage("#loginPassword")};n.viewModels.push(f),r.applyBindings(f,e("#home").get(0)),e("#home").on("pageshow",function(){if(o.hasHomePageErrorMessage()){f.pageMessage(o.getHomePageErrorMessage()),e("#homeButtons").css("visibility","visible").animate({opacity:1},250);return}e("#homeButtons").css("visibility")==="hidden"&&(e("#homeButtons").css("visibility","visible").animate({opacity:1},250),e("#nettellerLoginButton").css("visibility","visible").animate({opacity:1},250)),u.checkCompatible(function(t){t.match?(f.popupMessage(""),i.doPreLoginWorkflow(),i.doingPreLoginWorkflow.done(function(){n.globalNotifications!==null&&e.each(n.globalNotifications,function(t,n){n.Type==0?(f.popupMessage(n.Message),e("#homeMessagePopup").popup("open")):n.Type==1&&f.futureOutageMessage(n.Message)})})):(f.popupMessage(t.message),e("#homeMessagePopup").popup("open"))})}),e(document).on("tsw-logout",function(){f.pageMessage(a.strings["msg.loggedout"]),e.mobile.changePage("#home")}),e(document).on("tsw-communications-error",function(){o.setHomePageErrorMessage(a.strings["msg.commsfailure"]),document.location.href="#home",document.location.reload()}),e(document).on("tsw-session-expired",function(){o.setHomePageErrorMessage(a.strings["msg.sessionexpired"]),document.location.href="#home",document.location.reload()}),e(document).on("tsw-account-locked-from-authentication-device",function(){f.pageMessage(a.strings["msg.accountlockedfromauthenticationdevice"]),e.mobile.changePage("#home")})})