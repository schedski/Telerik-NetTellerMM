define(["lib/jquery","netteller/session","ui/loader","lib/knockout","netteller/contacts","config/environment","lib/toolkit","ui/startup"],function(e,t,n,r,i,s,o){var u={PayeeModelItem:null,PayeeName:r.observable(""),PayeeBSB:r.observable(""),PayeeAccountNumber:r.observable(""),reset:function(){u.PayeeName("")},submitPayee:function(){if(u.errors().length>0){c.showMessage(u.errors()[0]);return}var t={Id:u.PayeeModelItem.Id,UserEnteredName:u.PayeeName(),IsInternal:u.PayeeModelItem.IsInternal,Account:{AccountName:u.PayeeModelItem.AccountName,AccountNumber:u.PayeeModelItem.AccountNumber,BSB:u.PayeeModelItem.BSB}};u.submitData=t,e("#editPayeeConfirm").popup("open")},submitData:null,confirmed:function(){e("#editPayeeConfirm").popup("close"),i.updatePayee(u.submitData,u.contactSubmitResultHandler)},contactSubmitResultHandler:function(t){t.ContactType===i.ContactType.Payee&&e.mobile.changePage("#contacts",{transition:"none"})}};u.errors=r.validation.group(u);var a={BillerModelItem:null,BillerNickName:r.observable(""),BillerName:r.observable(""),BillerCode:r.observable(""),BillerCRN:r.observable(""),reset:function(){a.BillerNickName("")},submitBiller:function(){if(a.errors().length>0){c.showMessage(a.errors()[0]);return}var t={Id:a.BillerModelItem.Id,BillerCode:a.BillerModelItem.BillerCode,CRN:a.BillerModelItem.CustomerReferenceNumber,ShortName:a.BillerModelItem.ShortName,IsCRNConstant:a.BillerModelItem.IsCRNConstant,UserEnteredName:o.hasValue(a.BillerNickName())?a.BillerNickName():i.selectedContactToEdit.getUserEnteredName()};a.submitData=t,e("#editBillerConfirm").popup("open")},submitData:null,confirmed:function(){e("#editBillerConfirm").popup("close"),i.updateBiller(a.submitData,a.contactSubmitResultHandler)},contactSubmitResultHandler:function(t){t!=={}&&t.Success===!0&&t.ContactType===i.ContactType.Biller&&e.mobile.changePage("#contacts",{transition:"none"})}};a.errors=r.validation.group(a);var f={confirmed:function(){a.confirmed()}},l={confirmed:function(){u.confirmed()}},c={hasInfo:r.observable(!1),infoMessage:r.observable(""),reset:function(){c.hasInfo(!1),c.infoMessage("")},showMessage:function(t){c.hasInfo(!0),c.infoMessage(t),e.mobile.silentScroll(0)}};t.viewModels.push(a),t.viewModels.push(u),t.viewModels.push(l),t.viewModels.push(f),t.viewModels.push(c),e("#editContact").on("pageinit",function(){a.reset(),u.reset(),c.reset(),r.applyBindings(u,e("#editPayeeCollapsible").get(0)),r.applyBindings(l,e("#editPayeeConfirm").get(0)),r.applyBindings(a,e("#editBillerCollapsible").get(0)),r.applyBindings(f,e("#editBillerConfirm").get(0)),r.applyBindings(c,e("#editContactInfo").get(0)),r.applyBindings(c,e("#editContactInfo").get(0))}),e("#editContact").on("pagebeforeshow",function(){e("#editBillerCollapsible").hide(),e("#editbillerConfirm").hide(),e("#editPayeeCollapsible").hide(),e("#editPayeeConfirm").hide(),i.selectedContactToEdit!==null&&(i.selectedContactToEdit.getContactType()==i.ContactType.Payee&&(u.PayeeModelItem=i.selectedContactToEdit,u.PayeeName(i.selectedContactToEdit.getUserEnteredName()),u.PayeeBSB(i.selectedContactToEdit.BSB),u.PayeeAccountNumber(i.selectedContactToEdit.AccountNumber),e("#editPayeeCollapsible").show(),e("#editPayeeConfirm").show()),i.selectedContactToEdit.getContactType()==i.ContactType.Biller&&(a.BillerModelItem=i.selectedContactToEdit,a.BillerNickName(i.selectedContactToEdit.getUserEnteredName()),a.BillerCode(i.selectedContactToEdit.BillerCode),a.BillerName(i.selectedContactToEdit.ShortName),a.BillerCRN(i.selectedContactToEdit.CustomerReferenceNumber),e("#editBillerCollapsible").show(),e("#editbillerConfirm").show()))}),e("#editContact").on("pageshow",function(){}),e("#editContact").on("pagehide",function(){a.reset(),u.reset(),c.reset(),i.selectedContactToEdit=null})})