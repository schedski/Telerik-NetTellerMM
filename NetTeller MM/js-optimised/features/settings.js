define(["lib/jquery","netteller/session","lib/knockout","netteller/localstorage","ui/loader","netteller/security","netteller/pin","netteller/login","config/environment","ui/startup"],function(e,t,n,r,i,s,o,u,a){var f={status:n.computed(function(){return o.settingsPageStatus()}),deregisterDeviceStatus:n.observable(""),canEditPin:n.computed(function(){return s.isTokenOwner()}),canCreatePin:n.computed(function(){return!s.isTokenOwner()&&!s.isTokenVerified()}),changePin:function(){o.pinMode(o.pinModeEnum.Change),e.mobile.changePage("#pinKeypad")},setUpPin:function(){c.reset(),c.show(),t.hasPinCodeRegistered(p)},deregisterDevice:function(){l.reset(),l.show(),t.deregisterDevice(r.getTokenId(),h)}},l=new i.TimedLoader(a.strings["loader.deregistering"]),c=new i.TimedLoader(a.strings["loader.wait"]),h=function(t,n){var i=function(){t===!0?(r.deregisterPin(),s.isTokenOwner(!1),s.isTokenVerified(!1),o.settingsPageStatus(a.strings["msg.deregistered"]),e.mobile.changePage("#settings")):f.deregisterDeviceStatus(n)};l.loadFinished(i)},p=function(n,r,s){var u=function(){n===!0?(o.pinMode(o.pinModeEnum.RegisterFromSettings),s.HasPinCodeRegistered===!0?(c=new i.TimedLoader(a.strings["loader.registering"]),c.show(),t.registerPin("",d)):e.mobile.changePage("#pinKeypad")):o.settingsPageStatus(r)};c.loadFinished(u)},d=function(t,n){var i=function(){if(n!==null){r.registerPin(n.PinLoginToken,n.TokenId),s.isTokenOwner(!0),o.settingsPageStatus(a.strings["msg.pinregistered"]),e.mobile.changePage("#settings");return}d.status(t)};c.loadFinished(i)};t.viewModels.push(f),n.applyBindings(f,e("#settings").get(0)),n.applyBindings(f,e("#deregisterDevice").get(0)),e("#settings").on("pagehide",function(){o.settingsPageStatus("")}),e("#deregisterDevice").on("pagehide",function(){f.deregisterDeviceStatus("")})})