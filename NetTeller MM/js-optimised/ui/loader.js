define(["lib/jquery","config/client","lib/jquery.mobile"],function(e,t){var n={active:!1};return n.TimedLoader=function(r,i){var s=this;this.isModal=typeof i!="undefined"?!i:!0,this.minWait=t.loadingIndicatorMinimumDisplayTime,this.message=r,this.theme=t.loadingIndicatorTheme;var o={NotStarted:0,BackgroundLoading:1,ForegroundLoading:2,Finished:3},u=o.NotStarted,a=null;this.reset=function(){u=o.NotStarted},this.startBackgroundLoad=function(){u=o.BackgroundLoading},this.show=function(){if(u===o.Finished){n.active=!1;return}a=new Date,u=o.ForegroundLoading,s.isModal&&e.blockUI({message:null}),n.active=!0,e.mobile.loading("show",{text:s.message,textVisible:!0,theme:s.theme})};var f=function(t){return function(){s.isModal&&e.unblockUI(),n.active=!1,e.mobile.loading("hide"),t!==undefined&&t()}};this.loadFinished=function(t){if(u!==o.ForegroundLoading)t!==undefined&&t(),u=o.Finished,s.isModal&&e.unblockUI(),n.active=!1;else{var r=new Date,i=s.minWait-(r.getTime()-a.getTime());i=i<0?0:i,u=o.Finished,a=null,window.setTimeout(f(t),i)}}},n})